# Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.
# SPDX-License-Identifier: Apache-2.0

Schema: factory-2019-04-01
Portfolios:
  - DisplayName: "gas-acct-factory"
    Description: "G@S account vending machine"
    ProviderName: "G@S-Team"
    Tags:
      - Key: "type"
        Value: "governance"
      - Key: "creator"
        Value: "G@S-Team"
    Components:
      - Description: account-bootstrap-shared
        Distributor: CCOE
        Name: account-bootstrap-shared
        Owner: CCOE@Example.com
        Source:
          Configuration:
            RepositoryName: account-bootstrap-shared
          Provider: CodeCommit
        Constraints:
          Launch:
            LocalRoleName: SET_ME
        BuildSpec: |
          version: 0.2
          phases:
            install:
              runtime-versions:
                python: 3.8
            build:
              commands:
                - pip install -r requirements.txt -t src
              {% for region in ALL_REGIONS %}
                - aws cloudformation package --template $(pwd)/product.template.yaml --s3-bucket sc-factory-artifacts-${ACCOUNT_ID}-{{ region }} --s3-prefix ${STACK_NAME} --output-template-file product.template-{{ region }}.yaml
              {% endfor %}
          artifacts:
            files:
              - '*'
              - '**/*'
        SupportDescription: Find us on Slack or Wiki
        SupportEmail: ccoe-support@Example.com
        SupportUrl: https://example.com/intranet/teams/ccoe/products/account-factory
        Tags: []
        Versions:
          - Description:
              This product creates an AWS CodeBuild project that can be run to bootstrap an account.
              It also includes an AWS Lambda function that can be used to back a custom resource so that the
              CodeBuild project can be started from AWS CloudFormation
            Name: v4
            Source:
              Provider: CodeCommit
              Configuration:
                BranchName: v4
                RepositoryName: account-bootstrap-shared
      - Description: account-bootstrap-shared-org-bootstrap
        Distributor: CCOE
        Name: account-bootstrap-shared-org-bootstrap
        Owner: CCOE@Example.com
        Source:
          Configuration:
            RepositoryName: account-bootstrap-shared-org-bootstrap
          Provider: CodeCommit
        Constraints:
          Launch:
            LocalRoleName: SET_ME
        SupportDescription: Find us on Slack or Wiki
        SupportEmail: ccoe-support@Example.com
        SupportUrl: https://example.com/intranet/teams/ccoe/products/account-factory
        Tags: []
        Versions:
          - Description:
              This product creates an IAM Role that is required to use AWS Organizations
              to bootstrap AWS accounts
            Name: v1
            Source:
              Provider: CodeCommit
              Configuration:
                BranchName: v1
                RepositoryName: account-bootstrap-shared-org-bootstrap
      - Description: account-create-update-notifier
        Distributor: CCOE
        Name: account-create-update-notifier
        Owner: CCOE@Example.com
        Source:
          Configuration:
            RepositoryName: account-create-update-notifier
          Provider: CodeCommit
        Constraints:
          Launch:
            LocalRoleName: SET_ME
        SupportDescription: Find us on Slack or Wiki
        SupportEmail: ccoe-support@Example.com
        SupportUrl: https://example.com/intranet/teams/ccoe/products/account-factory
        Tags: []
        Versions:
          - Description:
              This product creates an AWS Lambda function to back a custom resource
              that dispatches notifications to an included SNS Topic
            Name: v2
            Source:
              Provider: CodeCommit
              Configuration:
                BranchName: v2
                RepositoryName: account-create-update-notifier
      - Description: account-creation-notifier-cfh-handler
        Distributor: CCOE
        Name: account-creation-notifier-cfh-handler
        Owner: CCOE@Example.com
        Source:
          Configuration:
            RepositoryName: account-creation-notifier-cfh-handler
          Provider: CodeCommit
        Constraints:
          Launch:
            LocalRoleName: SET_ME
        SupportDescription: Find us on Slack or Wiki
        SupportEmail: ccoe-support@Example.com
        SupportUrl: https://example.com/intranet/teams/ccoe/products/account-factory
        Tags: []
        Versions:
          - Description:
              This product creates an AWS Lambda as a subscription to an SNS topic.
              The Lambda function is used to relay messages from SNS to a custom HTTP POST endpoint
            Name: v1
            Source:
              Provider: CodeCommit
              Configuration:
                BranchName: v1
                RepositoryName: account-creation-notifier-cfh-handler
      - Description: account-creation-shared
        Distributor: CCOE
        Name: account-creation-shared
        Owner: CCOE@Example.com
        Source:
          Configuration:
            RepositoryName: account-creation-shared
          Provider: CodeCommit
        Constraints:
          Launch:
            LocalRoleName: SET_ME
        BuildSpec: |
          version: 0.2
          phases:
            install:
              runtime-versions:
                python: 3.8
            build:
              commands:
                - pip install -r requirements.txt -t src
              {% for region in ALL_REGIONS %}
                - aws cloudformation package --template $(pwd)/product.template.yaml --s3-bucket sc-factory-artifacts-${ACCOUNT_ID}-{{ region }} --s3-prefix ${STACK_NAME} --output-template-file product.template-{{ region }}.yaml
              {% endfor %}
          artifacts:
            files:
              - '*'
              - '**/*'
        SupportDescription: Find us on Slack or Wiki
        SupportEmail: ccoe-support@Example.com
        SupportUrl: https://example.com/intranet/teams/ccoe/products/account-factory
        Tags: []
        Versions:
          - Description:
              This product creates an AWS Lambda function for backing custom
              resources to create an AWS Account
            Name: v5
            Source:
              Provider: CodeCommit
              Configuration:
                BranchName: v5
                RepositoryName: account-creation-shared
      - Description: account-creation-shared-org-bootstrap
        Distributor: CCOE
        Name: account-creation-shared-org-bootstrap
        Owner: CCOE@Example.com
        Source:
          Configuration:
            RepositoryName: account-creation-shared-org-bootstrap
          Provider: CodeCommit
        Constraints:
          Launch:
            LocalRoleName: SET_ME
        SupportDescription: Find us on Slack or Wiki
        SupportEmail: ccoe-support@Example.com
        SupportUrl: https://example.com/intranet/teams/ccoe/products/account-factory
        Tags: []
        Versions:
          - Description:
              This product creates an IAM Role that is needed in order
              to use AWS Organizations to create AWS Accounts
            Name: v2
            Source:
              Provider: CodeCommit
              Configuration:
                BranchName: v2
                RepositoryName: account-creation-shared-org-bootstrap
      - Description: account-details
        Distributor: CCOE
        Name: account-details
        Owner: CCOE@Example.com
        Source:
          Configuration:
            RepositoryName: account-details
          Provider: CodeCommit
        Constraints:
          Launch:
            LocalRoleName: SET_ME
        SupportDescription: Find us on Slack or Wiki
        SupportEmail: ccoe-support@Example.com
        SupportUrl: https://example.com/intranet/teams/ccoe/products/account-factory
        Tags: []
        Versions:
          - Description: This product takes a provided 'AccountName' and returns
              the details about that account
            Name: v1
            Source:
              Provider: CodeCommit
              Configuration:
                BranchName: v1
                RepositoryName: account-details
      - Description: account-details-org-bootstrap
        Distributor: CCOE
        Name: account-details-org-bootstrap
        Owner: CCOE@Example.com
        Source:
          Configuration:
            RepositoryName: account-details-org-bootstrap
          Provider: CodeCommit
        Constraints:
          Launch:
            LocalRoleName: SET_ME
        SupportDescription: Find us on Slack or Wiki
        SupportEmail: ccoe-support@Example.com
        SupportUrl: https://example.com/intranet/teams/ccoe/products/account-factory
        Tags: []
        Versions:
          - Description: This product creates an IAM Role that is needed to use
              AWS Organizations to list AWS Accounts.
            Name: v1
            Source:
              Provider: CodeCommit
              Configuration:
                BranchName: v1
                RepositoryName: account-details-org-bootstrap
      - Description: account-puppet-org-bootstrap
        Distributor: CCOE
        Name: account-puppet-org-bootstrap
        Owner: CCOE@Example.com
        Source:
          Configuration:
            RepositoryName: account-puppet-org-bootstrap
          Provider: CodeCommit
        Constraints:
          Launch:
            LocalRoleName: SET_ME
        SupportDescription: Find us on Slack or Wiki
        SupportEmail: ccoe-support@Example.com
        SupportUrl: https://example.com/intranet/teams/ccoe/products/account-factory
        Versions:
          - Description:
              This product creates an AWS Lambda function that is used to move an
              AWS account to specified organizational unit (OU)
            Name: v1
            Source:
              Provider: CodeCommit
              Configuration:
                BranchName: v1
                RepositoryName: account-puppet-org-bootstrap
        ProviderName: ccoe
        Tags:
          - Key: team
            Value: ccoe
      - Description: account-type-to-organizational-unit-chooser
        Distributor: CCOE
        Name: account-type-to-organizational-unit-chooser
        Owner: CCOE@Example.com
        Source:
          Configuration:
            RepositoryName: account-type-to-organizational-unit-chooser
          Provider: CodeCommit
        Constraints:
          Launch:
            LocalRoleName: SET_ME
        SupportDescription: Find us on Slack or Wiki
        SupportEmail: ccoe-support@Example.com
        SupportUrl: https://example.com/intranet/teams/ccoe/products/account-factory
        Tags: []
        Versions:
          - Description:
              This product takes the given account type and returns the
              organizational unit it should be assigned to
            Name: v2
            Source:
              Provider: CodeCommit
              Configuration:
                BranchName: v2
                RepositoryName: account-type-to-organizational-unit-chooser
      - Description: account-waiter
        Distributor: CCOE
        Name: account-waiter
        Owner: CCOE@Example.com
        Source:
          Configuration:
            RepositoryName: account-waiter
          Provider: CodeCommit
        Constraints:
          Launch:
            LocalRoleName: SET_ME
        BuildSpec: |
          version: 0.2
          phases:
            install:
              runtime-versions:
                python: 3.8
            build:
              commands:
                - pip install -r requirements.txt -t src
              {% for region in ALL_REGIONS %}
                - aws cloudformation package --template $(pwd)/product.template.yaml --s3-bucket sc-factory-artifacts-${ACCOUNT_ID}-{{ region }} --s3-prefix ${STACK_NAME} --output-template-file product.template-{{ region }}.yaml
              {% endfor %}
          artifacts:
            files:
              - '*'
              - '**/*'
        SupportDescription: Find us on Slack or Wiki
        SupportEmail: ccoe-support@Example.com
        SupportUrl: https://example.com/intranet/teams/ccoe/products/account-factory
        Versions:
          - Description:
              This product creates an AWS Lambda function for backing custom
              resources that will wait for CodeBuild and CloudFormation to become
              available in a newly created account
            Name: v4
            Source:
              Provider: CodeCommit
              Configuration:
                BranchName: v4
                RepositoryName: account-waiter
        ProviderName: ccoe
        Tags:
          - Key: team
            Value: ccoe
      - Description: aws-control-tower-account-factory
        Distributor: CCOE
        Name: aws-control-tower-account-factory
        Owner: CCOE@Example.com
        Source:
          Configuration:
            RepositoryName: aws-control-tower-account-factory
          Provider: CodeCommit
        Constraints:
          Launch:
            LocalRoleName: SET_ME
        SupportDescription: Find us on Slack or Wiki
        SupportEmail: ccoe-support@Example.com
        SupportUrl: https://example.com/intranet/teams/ccoe/products/account-factory
        Tags: []
        Versions:
          - Description:
              Augments AWS Control Tower Account Factory - simplifies user input,
              dispatches extra parameters via AWS SNS andreturns the account id as an output
            Name: v1
            Source:
              Provider: CodeCommit
              Configuration:
                BranchName: v1
                RepositoryName: aws-control-tower-account-factory
      - Description: aws-service-catalog-account-creation
        Distributor: CCOE
        Name: aws-service-catalog-account-creation
        Owner: CCOE@Example.com
        Source:
          Configuration:
            RepositoryName: aws-service-catalog-account-creation
          Provider: CodeCommit
        Constraints:
          Launch:
            LocalRoleName: SET_ME
        SupportDescription: Find us on Slack or Wiki
        SupportEmail: ccoe-support@Example.com
        SupportUrl: https://example.com/intranet/teams/ccoe/products/account-factory
        Versions:
          - Description:
              This product is used to create a commercial AWS Account and bootstrap
              it using `aws-service-catalog-puppet` so you can provision products into the account
            Name: v4
            Source:
              Provider: CodeCommit
              Configuration:
                BranchName: v4
                RepositoryName: aws-service-catalog-account-creation
        ProviderName: ccoe
        Tags:
          - Key: team
            Value: ccoe
      - Description: aws-service-catalog-govcloud-account-creation
        Distributor: CCOE
        Name: aws-service-catalog-govcloud-account-creation
        Owner: CCOE@Example.com
        Source:
          Configuration:
            RepositoryName: aws-service-catalog-govcloud-account-creation
          Provider: CodeCommit
        Constraints:
          Launch:
            LocalRoleName: SET_ME
        SupportDescription: Find us on Slack or Wiki
        SupportEmail: ccoe-support@Example.com
        SupportUrl: https://example.com/intranet/teams/ccoe/products/account-factory
        Versions:
          - Description:
              This product is used to create a new GovCloud account and the linked commercial AWS Accounts.
              The accounts will be moved to the organizational unit (OU) based on the provided account groups
              and account types. The new accounts will be bootstrapped with the Service Catalog Puppet
              account in the corresponding partition.
            Name: v1
            Source:
              Provider: CodeCommit
              Configuration:
                BranchName: v1
                RepositoryName: aws-service-catalog-govcloud-account-creation
        ProviderName: ccoe
        Tags:
          - Key: team
            Value: ccoe
      - Description: move-to-ou
        Distributor: CCOE
        Name: move-to-ou
        Owner: CCOE@Example.com
        Source:
          Configuration:
            RepositoryName: move-to-ou
          Provider: CodeCommit
        Constraints:
          Launch:
            LocalRoleName: SET_ME
        BuildSpec: |
          version: 0.2
          phases:
            install:
              runtime-versions:
                python: 3.8
            build:
              commands:
                - pip install -r requirements.txt -t src
              {% for region in ALL_REGIONS %}
                - aws cloudformation package --template $(pwd)/product.template.yaml --s3-bucket sc-factory-artifacts-${ACCOUNT_ID}-{{ region }} --s3-prefix ${STACK_NAME} --output-template-file product.template-{{ region }}.yaml
              {% endfor %}
          artifacts:
            files:
              - '*'
              - '**/*'
        SupportDescription: Find us on Slack or Wiki
        SupportEmail: ccoe-support@Example.com
        SupportUrl: https://example.com/intranet/teams/ccoe/products/account-factory
        Versions:
          - Description:
              This product creates an AWS Lambda function that is used to move an
              AWS account to specified organizational unit (OU)
            Name: v3
            Source:
              Provider: CodeCommit
              Configuration:
                BranchName: v3
                RepositoryName: move-to-ou
        ProviderName: ccoe
        Tags:
          - Key: team
            Value: ccoe
