accounts:
  - account_id: "SET_ME"
    name: "puppet"
    default_region: us-east-1
    regions_enabled:
      - us-east-1
      - us-west-1
    tags:
      - type:prod
      - partition:aws
      - scope:puppet_account
  - ou: "/SET_ME"
    name: "organization-spokes"
    default_region: us-east-1
    regions_enabled:
      - us-east-1
      - us-west-1
    tags:
      - type:prod
      - partition:aws
      - scope:spoke
  - account_id: "SET_ME"
    name: "organization-management"
    default_region: us-east-1
    regions_enabled:
      - us-east-1
    tags:
      - type:prod
      - partition:aws
      - scope:org_management
launches:
  account-bootstrap-shared:
    depends_on:
      - account-bootstrap-shared-org-bootstrap
    deploy_to:
      tags:
        - regions: default_region
          tag: scope:puppet_account
        - regions: default_region
          tag: scope:org_management
    outputs:
      ssm:
        - param_name: /governance-at-scale-account-factory/account-bootstrap-shared/GovernanceAtScaleAccountFactoryBootstrapperProjectCustomResourceArn
          stack_output: GovernanceAtScaleAccountFactoryBootstrapperProjectCustomResourceArn
    parameters:
      AssumableRoleArnInRootAccountForBootstrapping:
        ssm:
          name: /governance-at-scale-account-factory/account-bootstrap-shared-org-bootstrap/AssumableRoleArnInRootAccountForBootstrapping
      ? GovernanceAtScaleAccountFactoryAccountBootstrapSharedBootstrapperIAMRoleName
      : default: AccountBootstrapSharedBootstrapperIAMRoleName
      ? GovernanceAtScaleAccountFactoryAccountBootstrapSharedCustomResourceIAMRoleName
      : default: AccountBootstrapSharedCustomResourceIAMRoleName
      GovernanceAtScaleAccountFactoryIAMRolePath:
        default: /AccountFactoryIAMRolePath/
    portfolio: gas-acct-factory
    product: account-bootstrap-shared
    version: v4
  account-bootstrap-shared-org-bootstrap:
    deploy_to:
      tags:
        - regions: default_region
          tag: scope:org_management
    outputs:
      ssm:
        - param_name: /governance-at-scale-account-factory/account-bootstrap-shared-org-bootstrap/AssumableRoleArnInRootAccountForBootstrapping
          stack_output: AssumableRoleArnInRootAccountForBootstrapping
    parameters:
      ? GovernanceAtScaleAccountFactoryAccountBootstrapSharedBootstrapperOrgIAMRoleName
      : default: AccountBootstrapSharedBootstrapperOrgIAMRoleName
      GovernanceAtScaleAccountFactoryIAMRolePath:
        default: /AccountFactoryIAMRolePath/
      OrganizationAccountAccessRole:
        default: OrganizationAccountAccessRole
      ServiceCatalogToolsAccountId:
        default: "SET_ME"
    portfolio: gas-acct-factory
    product: account-bootstrap-shared-org-bootstrap
    version: v1
  account-create-update-notifier:
    deploy_to:
      tags:
        - regions: default_region
          tag: scope:puppet_account
    outputs:
      ssm:
        - param_name: /governance-at-scale-account-factory/account-create-update-notifier/AccountCreateUpdateNotifierTopicArn
          stack_output: AccountCreateUpdateNotifierTopicArn
        - param_name: /governance-at-scale-account-factory/account-create-update-notifier/AccountCreateUpdateNotifierTopicName
          stack_output: AccountCreateUpdateNotifierTopicName
        - param_name: /governance-at-scale-account-factory/account-create-update-notifier/GovernanceAtScaleAccountFactoryAccountCreateUpdateNotifierCRArn
          stack_output: GovernanceAtScaleAccountFactoryAccountCreateUpdateNotifierCRArn
    parameters:
      GovernanceAtScaleAccountFactoryAccountCreateUpdateCRIAMRoleName:
        default: AccountCreateUpdateCRIAMRoleName
      GovernanceAtScaleAccountFactoryIAMRolePath:
        default: /AccountFactoryIAMRolePath/
    portfolio: gas-acct-factory
    product: account-create-update-notifier
    version: v2
  account-creation-notifier-cfh-handler:
    depends_on:
      - account-create-update-notifier
    deploy_to:
      tags:
        - regions: default_region
          tag: scope:puppet_account
    parameters:
      AccountCreateUpdateNotifierTopicArn:
        ssm:
          name: /governance-at-scale-account-factory/account-create-update-notifier/AccountCreateUpdateNotifierTopicArn
      GovernanceAtScaleAccountFactoryAccountCreateUpdateCFHHandlerIAMRoleName:
        default: AccountCreateUpdateCFHHandlerIAMRoleName
      GovernanceAtScaleAccountFactoryIAMRolePath:
        default: /AccountFactoryIAMRolePath/
      CFHAccountCreateUpdatePostUrl:
        default: https://example.com/intranet/teams/ccoe/products/account-factory/endpoint
    portfolio: gas-acct-factory
    product: account-creation-notifier-cfh-handler
    version: v1
  account-create-update-notifier-gov:
    deploy_to:
      tags:
        - regions: default_region
          tag: scope:org_management
    outputs:
      ssm:
        - param_name: /governance-at-scale-account-factory/account-create-update-notifier-gov/AccountCreateUpdateNotifierTopicArn
          stack_output: AccountCreateUpdateNotifierTopicArn
        - param_name: /governance-at-scale-account-factory/account-create-update-notifier-gov/AccountCreateUpdateNotifierTopicName
          stack_output: AccountCreateUpdateNotifierTopicName
        - param_name: /governance-at-scale-account-factory/account-create-update-notifier-gov/GovernanceAtScaleAccountFactoryAccountCreateUpdateNotifierCRArn
          stack_output: GovernanceAtScaleAccountFactoryAccountCreateUpdateNotifierCRArn
    parameters:
      GovernanceAtScaleAccountFactoryAccountCreateUpdateCRIAMRoleName:
        default: AccountCreateUpdateCRIAMRoleName
      GovernanceAtScaleAccountFactoryIAMRolePath:
        default: /AccountFactoryIAMRolePath/
    portfolio: gas-acct-factory
    product: account-create-update-notifier
    version: v2
  account-creation-notifier-cfh-handler-gov:
    depends_on:
      - account-create-update-notifier-gov
    deploy_to:
      tags:
        - regions: default_region
          tag: scope:org_management
    parameters:
      AccountCreateUpdateNotifierTopicArn:
        ssm:
          name: /governance-at-scale-account-factory/account-create-update-notifier-gov/AccountCreateUpdateNotifierTopicArn
      GovernanceAtScaleAccountFactoryAccountCreateUpdateCFHHandlerIAMRoleName:
        default: AccountCreateUpdateCFHHandlerIAMRoleName
      GovernanceAtScaleAccountFactoryIAMRolePath:
        default: /AccountFactoryIAMRolePath/
      CFHAccountCreateUpdatePostUrl:
        default: https://example.com/intranet/teams/ccoe/products/account-factory/endpoint
    portfolio: gas-acct-factory
    product: account-creation-notifier-cfh-handler
    version: v1
  account-creation-shared:
    depends_on:
      - account-creation-shared-org-bootstrap
    deploy_to:
      tags:
        - regions: default_region
          tag: scope:puppet_account
        - regions: default_region
          tag: scope:org_management
    outputs:
      ssm:
        - param_name: /governance-at-scale-account-factory/account-creation-shared/GovernanceAtScaleAccountFactoryAccountCreationCRArn
          stack_output: GovernanceAtScaleAccountFactoryAccountCreationCRArn
    parameters:
      GovernanceAtScaleAccountFactoryIAMRolePath:
        default: /AccountFactoryIAMRolePath/
      GovernanceAtScaleAccountFactoryAccountCreationSharedOrgRoleArn:
        ssm:
          name: /governance-at-scale-account-factory/account-creation-shared-org-bootstrap/GovernanceAtScaleAccountFactoryAccountCreationSharedOrgRoleArn
      OrganizationAccountAccessRole:
        default: OrganizationAccountAccessRole
    portfolio: gas-acct-factory
    product: account-creation-shared
    version: v5
  account-creation-shared-org-bootstrap:
    deploy_to:
      tags:
        - regions: default_region
          tag: scope:org_management
    outputs:
      ssm:
        - param_name: /governance-at-scale-account-factory/account-creation-shared-org-bootstrap/GovernanceAtScaleAccountFactoryAccountCreationSharedOrgRoleArn
          stack_output: GovernanceAtScaleAccountFactoryAccountCreationSharedOrgRoleArn
    parameters:
      GovernanceAtScaleAccountFactoryAccountCreationSharedOrgIAMRoleName:
        default: AccountCreationSharedOrgIAMRoleName
      GovernanceAtScaleAccountFactoryIAMRolePath:
        default: /AccountFactoryIAMRolePath/
      OrganizationAccountAccessRole:
        default: OrganizationAccountAccessRole
      ServiceCatalogToolsAccountId:
        default: "SET_ME"
    portfolio: gas-acct-factory
    product: account-creation-shared-org-bootstrap
    version: v2
  account-details:
    depends_on:
      - account-details-org-bootstrap
    deploy_to:
      tags:
        - regions: default_region
          tag: scope:puppet_account
        - regions: default_region
          tag: scope:org_management
    outputs:
      ssm:
        - param_name: /governance-at-scale-account-factory/account-details/GovernanceAtScaleAccountFactoryAccountDetailsCRArn
          stack_output: GovernanceAtScaleAccountFactoryAccountDetailsCRArn
    parameters:
      GovernanceAtScaleAccountFactoryAccountDetailsCRIAMRoleName:
        default: AccountDetailsCRIAMRoleName
      GovernanceAtScaleAccountFactoryAccountDetailsOrgRoleArn:
        ssm:
          name: /governance-at-scale-account-factory/account-details-org-bootstrap/GovernanceAtScaleAccountFactoryAccountDetailsOrgRoleArn
      GovernanceAtScaleAccountFactoryIAMRolePath:
        default: /AccountFactoryIAMRolePath/
    portfolio: gas-acct-factory
    product: account-details
    version: v1
  account-details-org-bootstrap:
    deploy_to:
      tags:
        - regions: default_region
          tag: scope:org_management
    outputs:
      ssm:
        - param_name: /governance-at-scale-account-factory/account-details-org-bootstrap/GovernanceAtScaleAccountFactoryAccountDetailsOrgRoleArn
          stack_output: GovernanceAtScaleAccountFactoryAccountDetailsOrgRoleArn
    parameters:
      GovernanceAtScaleAccountFactoryAccountDetailsOrgIAMRoleName:
        default: AccountDetailsOrgIAMRoleName
      GovernanceAtScaleAccountFactoryIAMRolePath:
        default: /AccountFactoryIAMRolePath/
      ServiceCatalogToolsAccountId:
        default: "SET_ME"
    portfolio: gas-acct-factory
    product: account-details-org-bootstrap
    version: v1
  account-puppet-org-bootstrap:
    deploy_to:
      tags:
        - regions: default_region
          tag: scope:puppet_account
    outputs:
      ssm:
        - param_name: /governance-at-scale-account-factory/account-puppet-org-bootstrap/PuppetAccountAccessRoleArn
          stack_output: AssumableRoleArnInPuppetAccountForBootstrapping
    parameters:
      OrganizationRootAccountId:
        default: "SET_ME"
      OrganizationAccountAccessRole:
        default: OrganizationAccountAccessRole
      AccountOnboardPuppetRoleName:
        default: PuppetAccountAccessRole
    portfolio: gas-acct-factory
    product: account-puppet-org-bootstrap
    version: v1
  account-type-to-organizational-unit-chooser:
    deploy_to:
      tags:
        - regions: default_region
          tag: scope:puppet_account
        - regions: default_region
          tag: scope:org_management
    outputs:
      ssm:
        - param_name: /governance-at-scale-account-factory/account-type-to-organizational-unit-chooser/GovernanceAtScaleAccountFactoryAccountTypeToOUChooserCRArn
          stack_output: GovernanceAtScaleAccountFactoryAccountTypeToOUChooserCRArn
    parameters:
      GovernanceAtScaleAccountFactoryAccountTypeChooserCRIAMRoleName:
        default: AccountTypeChooserCRIAMRoleName
      GovernanceAtScaleAccountFactoryIAMRolePath:
        default: /AccountFactoryIAMRolePath/
    portfolio: gas-acct-factory
    product: account-type-to-organizational-unit-chooser
    version: v2
  account-waiter:
    depends_on:
      - account-creation-shared-org-bootstrap
    deploy_to:
      tags:
        - regions: default_region
          tag: scope:puppet_account
        - regions: default_region
          tag: scope:org_management
    parameters:
      GovernanceAtScaleAccountFactoryAccountCreationSharedOrgRoleArn:
        ssm:
          name: /governance-at-scale-account-factory/account-creation-shared-org-bootstrap/GovernanceAtScaleAccountFactoryAccountCreationSharedOrgRoleArn
      GovernanceAtScaleAccountFactoryIAMRolePath:
        default: /AccountFactoryIAMRolePath/
      ServiceCatalogPuppetVersion:
        default: SET_ME
      OrganizationAccountAccessRole:
        default: OrganizationAccountAccessRole
    outputs:
      ssm:
        - param_name: /governance-at-scale-account-factory/account-waiter/GovernanceAtScaleAccountFactoryAccountWaiterCRArn
          stack_output: GovernanceAtScaleAccountFactoryAccountWaiterCRArn
    portfolio: gas-acct-factory
    product: account-waiter
    version: v4
  move-to-ou:
    depends_on:
      - account-creation-shared-org-bootstrap
    deploy_to:
      tags:
        - regions: default_region
          tag: scope:puppet_account
        - regions: default_region
          tag: scope:org_management
    parameters:
      GovernanceAtScaleAccountFactoryAccountCreationSharedOrgRoleArn:
        ssm:
          name: /governance-at-scale-account-factory/account-creation-shared-org-bootstrap/GovernanceAtScaleAccountFactoryAccountCreationSharedOrgRoleArn
      GovernanceAtScaleAccountFactoryIAMRolePath:
        default: /AccountFactoryIAMRolePath/
    outputs:
      ssm:
        - param_name: /governance-at-scale-account-factory/move-to-ou/GovernanceAtScaleAccountFactoryMoveToOUCRArn
          stack_output: GovernanceAtScaleAccountFactoryMoveToOUCRArn
    portfolio: gas-acct-factory
    product: move-to-ou
    version: v3
spoke-local-portfolios:
  account-vending-for-spokes:
    portfolio: gas-acct-factory
    associations:
      - arn:aws:iam::${AWS::AccountId}:role/SET_ME
    constraints:
      launch:
        - products:
            - aws-service-catalog-account-creation
            - aws-service-catalog-govcloud-account-creation
          roles:
            - arn:aws:iam::${AWS::AccountId}:role/SET_ME
    deploy_to:
      tags:
        - regions: default_region
          tag: scope:org_management
schema: puppet-2019-04-01
